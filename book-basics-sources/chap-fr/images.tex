% !TEX root = ../IntroImaging-FR.tex

\chapter{Le traitement d'images}
\label{chap-images}

\newcommand{\FootLink}[1]{\footnote{\url{#1}}}
\newcommand{\myparagraph}[1]{\vspace{2mm}\noindent\textbf{#1}}
\newcommand{\lien}[2]{#2}

%\newcommand{\bs}{\_}

\newcommand{\BetweenImageSpace}{\hspace{3mm}}

\newcommand{\image}[1]{\includegraphics[width=0.32\linewidth]{#1}}
\newcommand{\imageM}[1]{\includegraphics[width=0.4\linewidth]{#1}}
\newcommand{\imageL}[1]{\includegraphics[width=0.6\linewidth]{#1}}
\newcommand{\imageQuad}[8]{
\begin{tabular}{@{}c@{\BetweenImageSpace{}}c@{}}
\image{#1} & \image{#2}\\
#5 & #6 \\
\image{#3} & \image{#4}\\
#5 & #6 
\end{tabular}
}
\newcommand{\imageTri}[6]{
\begin{tabular}{@{}c@{\BetweenImageSpace{}}c@{\BetweenImageSpace{}}c@{}}
\image{#1} & \image{#2} & \image{#3}\\
#4 & #5 & #6 \\
\end{tabular}
}
\newcommand{\imageDuo}[4]{
\begin{tabular}{@{}c@{\BetweenImageSpace{}}c@{}}
\image{#1} & \image{#2} \\
#3 & #4  \\
\end{tabular}
}

\newcommand{\myfigure}[3]{
    \begin{figure}[ht]
    \begin{center}
        #1                          % usual include graphics
    \end{center}
    \vspace{-4mm}
        \caption{\textit{#2}}       % caption
    \label{#3}          % label
    \end{figure}
}



Les appareils numériques photographient de manière très précise le monde qui nous entoure. L'utilisateur souhaite pouvoir stocker avec un encombrement minimal ses photos sur son disque dur. Il souhaite également pouvoir les retoucher afin d'améliorer leur qualité. Cet article présente les outils mathématiques et informatiques qui permettent d'effectuer ces différentes tâches. Il reprend en partie le contenu de l'article publié sur le site web \textit{Images des mathématiques}\FootLink{http://images.math.cnrs.fr/Le-traitement-numerique-des-images.html}.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Les pixels d'une image}

Une \lien{http://fr.wikipedia.org/wiki/Image\bs{}num\%C3\%A9rique}{image numérique}
en niveaux de gris est un tableau de valeurs. Chaque
case de ce tableau, qui stocke une valeur, se nomme un 
\lien{http://fr.wikipedia.org/wiki/Pixel}{pixel}. 
En notant \(n\) le nombre de lignes et \(p\) le nombre de colonnes de l'image, 
on manipule ainsi un tableau de \(n \times p\) pixels. La figure \ref{fig-section1-original-zoom}, gauche, montre une visualisation d'un tableau carré avec  \(n=p=240\), ce qui représente  \(240\times 240\)=57600 pixels. Les
\lien{http://fr.wikipedia.org/wiki/Appareil\bs{}photographique\bs{}num\%C3\%A9rique}{appareils photos numériques} 
peuvent enregistrer des images beaucoup plus grandes,
avec plusieurs 
\lien{http://en.wikipedia.org/wiki/Gigapixel\bs{}image}{millions de pixels}.

Les valeurs des pixels sont enregistrées dans 
\lien{http://fr.wikipedia.org/wiki/Ordinateur}{l'ordinateur} ou
\lien{http://fr.wikipedia.org/wiki/Appareil\bs{}photographique\bs{}num\%C3\%A9rique}{l'appareil photo numérique} 
sous forme de 
\lien{http://fr.wikipedia.org/wiki/Entier\bs{}relatif}{nombres entiers} entre 0 et $255=2^8-1$, 
ce qui fait 256 valeurs possibles pour chaque pixel. La valeur 0 correspond au noir, et la valeur 255 correspond au blanc. Les valeurs intermédiaires correspondent à des 
\lien{http://fr.wikipedia.org/wiki/Niveau\bs{}de\bs{}gris}{niveaux de gris}
allant du noir au blanc. La figure \ref{fig-section1-original-zoom} montre un sous-tableau de \(6 \times 6\) pixels extrait de l'image précédente. On peut voir à la fois les valeurs qui composent le tableau et les niveaux de gris qui permettent d'afficher l'image à l'écran.
  
\myfigure{
\imageL{section1-original-zoom}
}{Sous image de taille $5 \times 5$}{fig-section1-original-zoom}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Stocker une image}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{\'Ecriture binaire}

Stocker de grandes images sur le 
\lien{http://fr.wikipedia.org/wiki/Disque\bs{}dur}{disque dur}
d'un ordinateur prend
beaucoup de place. Les nombres entiers sont stockés 
en 
\lien{http://fr.wikipedia.org/wiki/Syst\%C3\%A8me\bs{}binaire}{écriture binaire}, 
c'est-à-dire sous la forme d'une succession
de 0 et de 1. Chaque 0 et chaque 1 se stocke sur une unité élémentaire
de stockage, appelée 
\lien{http://fr.wikipedia.org/wiki/Bit}{bit}.
Pour obtenir l'écriture binaire d'un pixel ayant comme valeur 179, 
il faut décomposer cette valeur comme somme de puissances de deux. 
On obtient ainsi
\[ 179=2^7+2^5+2^4+2+1, \]
où l'on a pris soin d'ordonner les puissances de deux par ordre
décroissant. Afin de faire mieux apparaître l'écriture binaire, 
on ajoute "\(1 \times\)" devant chaque puissance qui apparaît dans l'écriture, 
et "\(0\times\)" devant les puissances qui n'apparaissent pas
\[ 179=1 \times 2^7 + 0 \times 2^6 + 1 \times 2^5 + 1 \times 2^4 + 
  0 \times 2^3 + 0 \times 2^2 + 1 \times 2^1 + 1 \times 2^0. \]
Avec une telle écriture, la valeur de chaque pixel, qui est un nombre entre 0 et 255, nécessite 
\( \log_2(256) = 8 \text{ bits}. \)
% La fonction \(\log_2\) est le logarithme en base 2, et ce calcul exprime
% le fait que  \( 256=2^8 \)
%  = 2 \times 2 \times 2 \times 2 \times 2 \times 2 \times 2 \times 2.  \]
L'écriture binaire de la valeur 179 du pixel est ainsi \((1,0,1,1,0,0,1,1)\).
% où chaque 1 et chaque 0 correspond au facteur multiplicatif qui apparaît devant chaque puissance.
On peut écrire toute valeur entre 0 et 255 de cet manière,
ce qui nécessite d'utilisation de 8 bits. Il y a en effet 
256 valeurs possibles, et \(256=2^8\). Pour stocker l'image complète, on a donc besoin de
\( n \times p \times 8 \text{ bits}. \)
Pour l'image montrée aux figure précédentes, on a ainsi besoin de 
\[ 256 \times 256 \times 8 = 524288 \text{ bits}. \]
On utilise le plus souvent 
\lien{http://fr.wikipedia.org/wiki/Octet}{l'octet} (8 bits) comme unité,
de sorte que cette image nécessite 57,6ko (kilo octets).


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Sous-échantilloner une image}


% on peut réduire sa
% \lien{http://fr.wikipedia.org/wiki/R\%C3\%A9solution\bs{}(imagerie\bs{}num\%C3\%A9rique)}{résolution},  c'est-à-dire

\myfigure{
\imageTri
%{section2-subsample-2}
{section2-subsample-4}
{section2-subsample-8}
{section2-subsample-16}
%{Une ligne/colonne sur 2}
{Une ligne/colonne sur 4}
{Une ligne/colonne sur 8}
{Une ligne/colonne sur 16}
}{Sous-échantillonnage d'une image}{fig-section2-subsample}

Afin de réduire la place de stockage d'une image on peut diminuer le nombre de pixels.
La façon la plus simple d'effectuer cette réduction consiste à supprimer des lignes et des colonnes dans l'image de départ. La figure \ref{fig-section2-subsample}, en haut à gauche, montre ce que l'on obtient si l'on retient une ligne sur 4 et une colonne sur 4. On a ainsi divisé par \(4 \times 4 = 16\) le nombre de pixels de l'image,
et donc également divisé par 16 le nombre de bits nécessaire pour stocker l'image sur 
un disque dur. Sur la figure \ref{fig-section2-subsample}, on peut voir les résultats obtenus en enlevant de plus en
plus de lignes et de colonnes. Bien entendu, la qualité de l'image se
dégrade vite.



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Quantifier une image}

Une autre façon de réduire la place mémoire nécessaire pour le stockage
consiste à utiliser moins de nombres entiers pour chaque valeur. On peut par exemple utiliser uniquement des nombres entiers entre 0 et 3, ce qui donnera une image avec uniquement 4 niveaux de gris.  On peut effectuer une conversion de l'image d'origine vers une image avec 4 niveaux de valeurs en effectuant les remplacements:
\begin{rs}
\item les valeurs dans \(0,1,\ldots,63\) sont remplacées par la valeur 0 (noir), 
\item les valeurs dans \(64,1,\ldots,127\) sont remplacées par la valeur 1 (gris clair), 
\item les valeurs dans \(128,1,\ldots,191\) sont remplacées par la valeur 2 (gris foncé), 
\item les valeurs dans \(192,\ldots,255\) sont remplacées par la valeur 3 (blanc).
\end{rs}
Une telle opération se nomme \lien{http://fr.wikipedia.org/wiki/Quantification\bs{}(signal)}{quantification}. La \ref{fig-section3-quantize}, au centre, suivante montre l'image résultante avec 4 niveaux de couleurs.

Nous avons déjà vu que l'on pouvait représenter toute valeur entre 0 et
255 à l'aide de 8 bits en utilisant l'écriture binaire. De façon similaire, 
on vérifie que toute valeur entre 0 et 3 peut se représenter à l'aide de 2 bits. 
On obtient ainsi une réduction d'un facteur 8/2=4 de la place 
\lien{http://fr.wikipedia.org/wiki/M\%C3\%A9moire\bs{}(informatique)}{mémoire} 
nécessaire 
pour le stockage de l'image sur un disque dur. La figure \ref{fig-section3-quantize} montre les résultats obtenus en utilisant de moins en moins de niveaux de gris.

\myfigure{
\imageDuo
%{section3-quantize-2}
%{section3-quantize-3}
{section3-quantize-4}
{section3-quantize-16}
%{16 niveaux de gris}
%{3 niveaux de gris}
{4 niveaux de gris}
{16 niveaux de gris}
}{Quantification d'une image
}{fig-section3-quantize}
 
Tout comme pour la réduction du nombre de pixels, la réduction du nombre
de niveaux de gris influe beaucoup sur la qualité de l'image. 
Afin de réduire au maximum la taille d'une image sans modifier sa qualité,
on utilise des méthodes plus complexes de 
\lien{http://fr.wikipedia.org/wiki/Compression\bs{}d\%27image}{compression d'image}. 
% \ArticleAPMEP{La vignette Klein de ce numéro détaille une méthode qui exploite la décomposition en valeurs singulières des matrices.}


La méthode  la plus efficace s'appelle
\lien{http://fr.wikipedia.org/wiki/Jpeg\bs{}2000}{JPEG-2000}. 
Elle utilise la théorie des 
\lien{http://fr.wikipedia.org/wiki/Ondelettes}{ondelettes}.
Pour en savoir plus à ce sujet, vous pouvez consulter l'article d'Erwan Le Pennec sur le site web \textit{Images des mathématiques}\FootLink{http://images.math.cnrs.fr/Compression-d-image.html}. 





%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Enlever le bruit}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Moyenne locale}

Les images sont parfois de mauvaise qualité. Un exemple typique de défaut
est le 
\lien{http://fr.wikipedia.org/wiki/Bruit\bs{}num\%C3\%A9rique}{\guill{bruit}}
qui apparait quand une photo est 
\lien{http://fr.wikipedia.org/wiki/Exposition\bs{}(photographie)}{sous-exposée}, 
c'est-à-dire
qu'il n'y a pas assez de luminosité. Ce bruit se manifeste par de petites
fluctuations 
\lien{http://fr.wikipedia.org/wiki/Suite\bs{}al\%C3\%A9atoire}{aléatoires}
des niveaux de gris. La figure \ref{fig-section5-moyenne}, à gauche, montre
une image bruitée. 



\myfigure{
\imageM{section5-moyenne-numbers}
}{Voisinage de pixels.
}{fig-section5-moyenne-numbers}

Afin d'enlever le bruit dans les images, il convient de faire subir une
modification aux valeurs de pixels. 
L'opération la plus simple consiste à remplacer la valeur 
\(a\) de chaque pixel par la 
\lien{http://fr.wikipedia.org/wiki/Moyenne}{moyenne}
de  \(a\) et des 8 valeurs \(b,c,d,e,f,g,h,i\) des 8 pixels qui entourent $a$ . La figure \ref{fig-section5-moyenne-numbers} montre un exemple de voisinage de 9 pixels. On obtient ainsi une image modifiée en remplaçant a par
\[ \frac{a+b+c+d+e+f+g+h+i}{9} \]
puisque l'on fait la moyenne de 9 valeurs.
Dans notre exemple, cette moyenne vaut
\[ \frac{190+192+79+54+47+153+203+189+166}{9} \approx 141. \]
En effectuant cette opération pour chaque pixel, on supprime une partie 
du bruit, car ce bruit est constitué de fluctuations aléatoires, qui sont
diminuées par un calcul de moyennes. La figure \ref{fig-section5-moyenne}, en haut à gauche, montre l'effet d'un tel calcul. Tout le bruit n'a pas été enlevé par cette opération. Afin d'enlever plus
de bruit, on peut moyenner plus de valeurs autour de chaque pixel.
La figure \ref{fig-section5-moyenne} montre le résultat obtenu en moyennant de plus en plus
de valeurs. 


\myfigure{
\imageTri
{section5-moyenne-1}
{section5-moyenne-2}
{section5-moyenne-3}
%{section5-moyenne-4}
{Moyenne sur 9 pixels}
{Moyenne sur 25 pixels}
{Moyenne sur 49 pixels}
%{Moyenne sur 81 pixels}
}{Moyenne de plus en plus forte
}{fig-section5-moyenne}

Le moyennage des pixels est très efficace pour enlever le bruit dans les
images, malheureusement il détruit également une grande partie de
l'information de l'image. On peut en effet s'aper\-ce\-voir que les images
obtenues par moyennage sont 
\lien{http://fr.wikipedia.org/wiki/Flou,\bs{}nettet\%C3\%A9\bs{}et\bs{}contraste}{floues}. 
Ceci est en particulier visible près
des contours, qui ne sont pas nets.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Médiane locale}

Afin de réduire ce flou, on remplace la moyenne par la médiane. Dans l'exemple du voisinage de 9 pixels utilisé à la section précédente, les 9 valeurs classées sont :
\[ 47,54,79,153,166,189,190,192,203. \]
La médiane de ces neuf valeurs est 166.  Afin d'enlever plus de bruit, il suffit de calculer la médiane sur un nombre plus grand de pixels voisins, comme montré à la figure \ref{fig-section6-mediane}.
On constate que cette méthode est plus performante que le calcul de
moyennes, car les images résultantes sont moins floues. Cependant, tout comme 
avec le calcul de moyennes, si l'on prend des voisinages trop grands, on perd
aussi de l'information de l'image, en particulier les bords des objets sont dégradés.


\if 0
Afin de réduire ce flou, il faut remplacer le moyennage par une opération
un peu plus complexe, que l'on nomme 
\lien{http://fr.wikipedia.org/wiki/M\%C3\%A9diane}{mediane}. Etant donné la valeur \(a\) d'un pixel, et les valeurs
\(b,c,d,e,f,g,h,i\), on commence par les classer 
par 
\lien{http://fr.wikipedia.org/wiki/Ordre\bs{}croissant}{ordre croissant}.
Dans l'exemple du voisinage de 9 pixels utilisé à la section précédente, 
on obtient les 9 valeurs classées
\[ 47,54,79,153,166,189,190,192,203. \]
La médiane des neuf valeurs \(a,b,c,d,e,f,g,h,i\)
est la \(5^\text{e}\) valeur de ce classement (c'est-à-dire la 
valeur centrale de ce classement).

Dans notre cas, la médiane est donc 166. Notez que ce nombre est en général différent de la moyenne.

\fi


\myfigure{
\imageTri
{section6-mediane-1}
{section6-mediane-2}
{section6-mediane-3}
%{section6-mediane-4}
{Médiane sur 9 pixels}
{Médiane sur 25 pixels}
{Médiane sur 49 pixels}
%{Médiane sur 81 pixels}
}{Filtrage médian de plus plus en plus fort.
}{fig-section6-mediane}




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Détecter les bords des objets}

Afin de localiser des objets dans les images, il est nécessaire de
détecter les 
\lien{http://fr.wikipedia.org/wiki/D\%C3\%A9tection\bs{}de\bs{}contours}{bords}
de ces objets. Ces bords correspondent à des 
zones de l'image où les valeurs des pixels changent rapidement. C'est le
cas par exemple lorsque l'on passe de la coque du bateau (qui est sombre,
donc avec des valeurs petites) à la mer (qui est claire, donc avec des
valeurs grandes).

Afin de savoir si un pixel avec une valeur \(a\) est le long d'un bord d'un objet, on prend en compte les valeurs \(b,c,d,e\) de ses quatre voisins qui ont un côté commun avec lui (figure \ref{fig-section7-contours-numbers}).  Ceci permet de détecter aussi précisément que possible les bords des objets. 

\if 0
(deux horizontalement et deux verticalement), qui sont disposés par rapport à \(a\) comme illustré à la figure \ref{fig-section7-contours-numbers}. Notons que l'on utilise ici seulement les 4 voisins qui ont un coté commun avec le pixel considéré, ce qui est différent du calcul de moyennes et de médianes où l'on utilisait 8 voisins. Ceci est important afin de détecter aussi précisément que possible les bords des objets.
\fi 


\myfigure{
\imageM{section7-contours-numbers}
}{Exemple d'un voisinage de 5 pixels.
}{fig-section7-contours-numbers}


On calcule une valeur \(\ell\) suivant la formule
\[ \ell = \sqrt{ (b-d)^2 + (c-e)^2 }.  \]
Dans notre exemple, on obtient donc
\[ \ell= \sqrt{ (192 - 153)^2 + (189 - 54)^2 } = \sqrt{19746} \approx 141. \]
On peut remarquer que si \(\ell=0\), alors on a \(b=c\)
et \(d=e\). Au contraire, si 
\(\ell\) est grand, ceci signifie que les pixels voisins ont des valeurs très
différentes, le pixel considéré est donc probablement sur le bord d'un objet. 

La figure \ref{fig-section7-contours} montre une image dont la valeur des pixels est $\min(\ell,255)$. 
Il est nécessaire de prendre le minium avec 255, car la valeur de $\ell$ peut dépasser la valeur maximale affichable (255, qui correspond au blanc). On a ainsi affiché ces valeurs avec du noir quand \(\ell=0\),  du blanc quand \(\ell\) est grand, et on a utilisé des niveaux de gris pour les valeurs intermédiaires. On peut voir que dans l'image de droite, les contours des objets ressortent en blanc, car ils correspondent aux grandes valeurs de \(\ell\).

\myfigure{
\imageDuo
{section7-image}
{section7-contours}
{Image d'origine}
{Carte de contours $\ell$}
}{Détection des bords.
}{fig-section7-contours}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Les images couleurs}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Espace RVB}

Une 
\lien{http://fr.wikipedia.org/wiki/Couleur}{image couleur}
est en réalité composée de trois images indépendantes,
afin de représenter le
\lien{http://fr.wikipedia.org/wiki/Rouge\bs{}vert\bs{}bleu}{rouge, le vert, et le bleu}. 
Chacune de ces trois
images s'appelle un 
\lien{http://fr.wikipedia.org/wiki/Codage\bs{}informatique\bs{}des\bs{}couleurs}{canal}.
Cette représentation en rouge, vert et bleu mime le fonctionnement du
système visuel humain.
La figure \ref{fig-canaux-coul} montre les trois canaux constitutifs de l'image montrée sur la gauche de la figure \ref{fig-luminance}.

\myfigure{
\imageDuo
{section8-image}
{section8-luminance}
{Image d'origine}
{Luminance}
}{Image couleur.
}{fig-luminance}


Chaque pixel de l'image couleur contient ainsi trois nombres \( (r,v,b) \),
chacun étant un nombre entier entre 0 et 255.
Si le pixel est égal à \((r,v,b)=(255,0,0)\), il ne contient que de l'information
rouge, et est affiché comme du rouge. 
De façon similaire, les pixels valant \((0,255,0)\) et \((0,0,255)\) sont
respectivement affichés vert et bleu.


\myfigure{
\imageTri
{section8-rouge}
{section8-vert}
{section8-bleu}
{Canal rouge}
{Canal vert}
{Canal bleu}
}{Canaux couleurs
}{fig-canaux-coul}


On peut afficher à l'écran une image couleur à
partir de ses trois canaux \((r,v,b)\) en utilisant les règles de la 
\lien{http://fr.wikipedia.org/wiki/Synth\%C3\%A8se\bs{}additive}{synthèse additive des couleurs}. Ces règles correspondent à la façon dont les rayons lumineux se combinent, d'où le qualificatif \guill{additif}.  
La figure \ref{fig-section8-synthese}, gauche, montre les règles de composition
cette synthèse additive des couleurs. 
Par exemple un pixel avec les valeurs
\((r,v,b)=(255,0,255)\) est un mélange de rouge et de vert, il est donc
affiché comme du jaune.


\myfigure{
\imageDuo
{section8-synthese-additive}
{section8-synthese-soustractive}
{Synthèse additive}
{Synthèse soustractive}
}{Synthèse des couleurs
}{fig-section8-synthese}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Espace CMJ}

Une autre représentation courante pour les images couleurs utilise
comme couleurs de base le cyan, le magenta et le jaune. On calcule 
les trois nombres \((c,m,j)\) correspondant à chacun de ces trois canaux à 
partir des canaux rouge, vert et bleu \((r,v,b)\) comme suit
\[ c=255-r, \quad m=255-v, \quad j=255-b. \]
Par exemple, un pixel de bleu pur 
\((r,v,b)=(0,0,255)\) va devenir 
\( (c,m,j)=(255,255,0) \). La figure suivante montre les trois canaux
\((c,m,j)\) d'une image couleur.

\myfigure{
\imageTri
{section8-cyan}
{section8-magenta}
{section8-jaune}
{Canal cyan}
{Canal magenta}
{Canal jaune}
}{Canaux CMJ
}{fig-canaux-cmj}


Afin d'afficher une image couleur à l'écran à partir des trois canaux \((c,m,j)\), on doit utiliser la synthèse soustractive des couleurs. La figure \ref{fig-section8-synthese}, droite, montre les règles de composition cette synthèse soustractive. Elle correspondent en peinture à l'absorption de la lumière par les pigments colorés, d'où le qualificatif \guill{soustractif}. Le cyan, le magenta et le jaune sont appelés couleurs primaires.

On peut donc stocker sur un disque dur une image couleur en stockant les
trois canaux, correspondant aux valeurs \((r,g,b)\) ou \((c,m,j)\). 
On peut modifier les images couleur tout comme les images en niveaux de
gris. La façon la plus simple de procéder consiste à appliquer la modification
à chacun des canaux.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Changer le contraste d'une image}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Luminance}

On peut calculer une image en niveaux de gris à partir d'une image couleur
en moyennant les trois canaux. On calcule donc, pour chaque pixel, une valeur 
\[ a = \frac{r+v+b}{3} \]
qui s'appelle la 
\lien{http://fr.wikipedia.org/wiki/Luminance}{luminance} 
de la couleur. La figure \ref{fig-luminance}  montre le passage d'une image couleur à une image de luminance en
niveaux de gris. 


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Manipulations du contraste en niveaux de gris}

Il est possible de faire subir différentes modifications à l'image afin de
changer son 
\lien{http://fr.wikipedia.org/wiki/Contraste}{contraste}. On considère ici une image en niveaux de gris.
Un manipulation simple consiste à remplacer chaque valeur \(a\) d'un pixel d'une image par \(255-a\) ce qui correspond à l'intensité de gris opposée. Le blanc devient noir et vice-et-versa, ce qui donne un effet similaire à celui
des 
\lien{http://fr.wikipedia.org/wiki/Film\bs{}n\%C3\%A9gatif}{négatifs}
\lien{http://fr.wikipedia.org/wiki/Argentique}{d'appareils photos argentiques}, voir figure \ref{fig-section4-square}, gauche.

On éclaircit ou assombrit l'image en utilisant une fonction croissante de $[0,255]$ dans lui-même, que l'on applique aux valeurs $a$ des pixels. On peut assombrir l'image en utilisant la fonction carré. Plus précisément, on définit la nouvelle valeur d'un pixel de l'image comme $a^2/255$ (voir figure \ref{fig-section4-square} au centre). Le résultat n'étant en général pas un entier, on l'arrondit à l'entier le plus proche. De façon analogue, pour éclaircir l'image on remplace la valeur $a$ de chaque pixel par l'arrondi entier de $\sqrt{ 255 a}$. La figure \ref{fig-section4-square}, à droite, montre l'éclaircissement obtenu. On pourra noter que ces deux opérations (éclaircissement par carré et assombrissement par racine carrée) sont inverses l'une de l'autre.

% On pourra noter que ces deux opérations (éclaircissement par carré et assombrissement par racine carrée) sont inverses l'une de l'autre.


\myfigure{
\imageTri{section4-negatif}
{section4-square}
{section4-sqrt}
{Négatif}
{Carré}
{Racine carrée}
}{Changement de contraste.
}{fig-section4-square}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Manipulations du contraste en couleur}

Afin de manipuler le contraste d'une image couleur, il est important de respecter autant que possible les teintes des couleurs. On souhaite donc ne manipuler que la composante de luminance \(a=(r+v+b)/3\), en conservant constant le résidu \((r-a,v-a,b-a)\). On peut par exemple définir un changement de contraste en élevant la luminance \(a\) à la puissance \(\ga>0\), afin d'obtenir 
\[
	\tilde a = 255 \times \pa{ \frac{a}{255} }^{\ga} = 255 \times \text{exp}\pa{  \ga \times \text{ln}
		\pa{ \frac{a}{255} }  },
\]
(avec la convention \(\tilde a=0\) lorsque \(a=0\)). On remarque que pour \(\ga=1/2\) (respectivement \(\ga=2\)) on retrouve le changement de contraste par passage au carré (respectivement à la racine carrée) introduit à la section précédente. Et bien sûr, pour \(\ga=1\), la luminance est inchangée.

% Comme \(\ga\) n'est pas nécessairement un nombre entier, il est important d'utiliser l'exponentielle et le logarithme pour définir ce changement. 

Ce changement de contraste est ensuite répercuté sur l'image couleur en définissant trois canaux \((\tilde r,\tilde v, \tilde b)\) d'une nouvelle image par
\[
	\choice{
	\tilde r = \max(0, \min(255, r + \tilde a - a)),\\ 
	\tilde v = \max(0, \min(255, v + \tilde a - a)),\\
	\tilde b = \max(0, \min(255, b + \tilde a - a)).
	}	
\]
Il est important de prendre le maximum avec 0 et le minimum avec 255 afin que le résultat reste dans l'intervalle \([0,255]\), et soit affiché de manière correcte. La figure \ref{fig-contraste-couleur} montre le résultat obtenu pour différentes valeurs de \(\ga\). Pour \(\ga<1\), l'image est éclaircie, alors que pour \(\ga>1\), l'image est assombrie. 

\newcommand{\imgsix}[1]{\includegraphics[width=0.16\linewidth]{#1}}

\myfigure{
\begin{tabular}{@{}c@{\hspace{1mm}}c@{\hspace{1mm}}c@{\hspace{1mm}}c@{\hspace{1mm}}c@{\hspace{1mm}}c@{}}
\imgsix{section4-constrast-1}&
\imgsix{section4-constrast-2}&
\imgsix{section4-constrast-3}&
\imgsix{section4-constrast-4}&
\imgsix{section4-constrast-5}&
\imgsix{section4-constrast-6}\\
$\ga=0,5$& 
$\ga=0,75$&
$\ga=1$&
$\ga=1,5$&
$\ga=2$&
$\ga=3$
\end{tabular}
}{Changement de contraste d'une image couleur.
}{fig-contraste-couleur}





%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Images et matrices}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Symétrie et rotation}

Une image est un tableau de nombres, avec \(n\) lignes et \(p\) 
colonnes. Il est donc facile d'effectuer
certaines 
\lien{http://fr.wikipedia.org/wiki/Transformation\bs{}g\%C3\%A9om\%C3\%A9trique}{transformations géométriques}
sur l'image. Les valeurs des pixels qui composent ce tableau (noté \(A\)) peuvent être 
représentées sous la forme \( A = ( a_{i,j} )_{i,j} \)
ou l'index \(i\) décrit l'ensemble des nombres \( \{1,\ldots,n\} \)
(les entiers entre 1 et n) et l'index 
\(j\) les nombres \( \{1,\ldots,p\} \).
On dit que \(a_{i,j}\) est la valeur du pixel à la position \((i,j)\).

Le tableau de pixels ainsi indexé se représente de la façon
suivante
\[
A = 
\begin{pmatrix}
a_{1,1} &           &           &   & a_{1,p}\\
       &           &  \vdots   &   &  \\
	   &           & a_{i-1,j} &   & \\
\ldots & a_{i,j-1} & a_{i,j}   & a_{i,j+1} & \ldots\\
	   &           & a_{i+1,j} &   & \\
       &           &  \vdots   &   &  \\
a_{n,1} &           &           &   & a_{n,p}\\
\end{pmatrix},
\]
% ce qui montre que le pixel en haut à gauche de l'image correspond à la valeur \(a_{1,1}\). 

Ceci correspond à la représentation de l'image sous forme d'une matrice. Transposer cette matrice correspond à effectuer une symétrie par rapport à la diagonale principale. On effectue cette transposition sur chacune des trois composantes couleurs (voir figure \ref{fig-geometrique}, à gauche). 

\if 0
Ceci correspond à la représentation de l'image sous
forme d'une 
\lien{http://fr.wikipedia.org/wiki/Matrice\bs{}(math\%C3\%A9matiques)}{matrice}.
Si l'on échange les lignes et les colonnes, on définit un autre
tableau \(B\) avec \(p\) lignes et \(n\) colonnes. La formule qui définit
le tableau \(B = ( b_{j,i} )_{i,j}\) est $b_{j,i} = a_{i,j}$.
Ceci correspond à la 
\lien{http://fr.wikipedia.org/wiki/Matrice\bs{}transpos\%C3\%A9e}{transposition} 
de la matrice des pixels de l'image. Pour une image couleur, on effectue cette modification sur chacune de ses
trois composantes couleur R, V et B.

La figure \ref{fig-geometrique} montre l'image des tableaux \(A\) et \(B\). La
modification correspond à faire subir à l'image une 
\lien{http://fr.wikipedia.org/wiki/Sym\%C3\%A9trie\bs{}(transformation\bs{}g\%C3\%A9om\%C3\%A9trique)}{symétrie} 
par rapport à la 
\lien{http://fr.wikipedia.org/wiki/Diagonale}{diagonale}
qui joint le coin haut/gauche au coin bas/droite.
\fi

\myfigure{
\imageTri
{section10-original}
{section10-transpose}
{section10-rotation}
{Matrice $A$}
{Matrice $B$ (transposée)}
{Matrice $C$ (rotation)}
}{Transposition et rotation.
}{fig-geometrique}

On peut également effectuer une 
\lien{http://fr.wikipedia.org/wiki/Rotation}{rotation}
d'un quart de tour dans le sens des aiguilles d'une montre à
l'image. Ceci est obtenu en définissant une matrice \(C = (c_{i,j})_{j,i}\) de 
\(p\) lignes et \(n\)
colonnes par $c_{j,i} =  a_{n-i+1,j}$.
La figure \ref{fig-geometrique}, droite, montre l'action de cette rotation sur une image.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Fondu entres deux images}

On souhaite effectuer une 
\lien{http://fr.wikipedia.org/wiki/Fondu}{transition entre deux images}
\(A\) et \(B\) de même
taille. On suppose donc que les deux images ont le même nombre \(n\) de lignes
et le même nombre \(p\) de colonnes. On note \(A = (a_{i,j})_{i,j}\) les pixels de l'image \(A\) et 
\(B = (b_{i,j})_{i,j}\) les pixels de l'image \(B\).


Pour une valeur \(t\) fixée entre \(0\) et \(1\), on définit l'image
\(C = (c_{i,j})_{i,j}\) comme 
\[ c_{i,j}  = (1-t) a_{i,j} + t b_{i,j}.\]
Il s'agit de la formule d'une 
\lien{http://fr.wikipedia.org/wiki/Interpolation\bs{}lin\%C3\%A9aire}{interpolation linéaire}
entre les deux images. Pour une image couleur, on applique cette formule à chacun des
canaux R, V et B.


On peut constater que pour \(t=0\), l'image \(C\) est égale à l'image
\(A\). Pour \(t=1\), l'image \(C\) est égale à l'image
\(B\). Lorsque la valeur \(t\) progresse de 0 à 1, on obtient ainsi un
effet de fondu, puisque l'image, qui au départ est proche de l'image \(A\)
ressemble de plus en plus à l'image \(B\). La figure \ref{fig-interp} montre le résultat obtenu pour 6 valeurs de \(t\) réparties entre 0 et 1.

\myfigure{
\begin{tabular}{@{}c@{\hspace{1mm}}c@{\hspace{1mm}}c@{\hspace{1mm}}c@{\hspace{1mm}}c@{\hspace{1mm}}c@{}}
\imgsix{section11-interp-1}&
\imgsix{section11-interp-2}&
\imgsix{section11-interp-3}&
\imgsix{section11-interp-4}&
\imgsix{section11-interp-5}&
\imgsix{section11-interp-6}\\
Image $A$, t=0 & 
t=0,2 &
t=0,4 &
t=0,6 &
t=0,8 &
Image $B$, t=1
\end{tabular}
}{Interpolation linéaire.
}{fig-interp}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{Conclusion}

Le traitement mathématique des images est un domaine très actif, où les avancées théoriques se concrétisent sous la forme d'algorithmes  rapides de calcul. Ces algorithmes ont des applications importantes pour la manipulation des contenus numériques. Cet article n'a cependant fait qu'effleurer l'immense liste des traitements que l'on peut faire subir à une image.
Les personnes intéressées pourront également consulter le site web \textit{A Numerical Tour of Signal Processing}\FootLink{http://www.numerical-tours.com/} pour de nombreux exemples de traitements d'images ainsi que des liens vers d'autres ressources disponibles en ligne. 




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section*{Glossaire}

% \newcommand{\gloss}[1]{\item \textbf{#1}}

\begin{rs}
\gloss{Aléatoire} : valeur imprévisible souvent due au hazard, comme par exemple le bruit qui perturbe les images de mauvaises qualités.
\gloss{Bit} : unité élementaire de stockage de l'information sous forme de 0 et de 1 dans un ordinateur.
\gloss{Canal} : une des trois images élémentaires qui composent une image couleur.
\gloss{Bords} : zone d'une image où les valeurs des pixels varient beaucoup, qui correspond aux contours des objets qui forment l'image.
\gloss{Bruit} : petites perturbations qui dégradent la qualité d'une image.
\gloss{Carré} : le carré \(b\) d'une valeur \(a\) est \(a \times a\). Il est noté \(a^2\).
\gloss{Contraste} : quantité informelle qui indique la différence entre les zones claires et les zones sombres d'une image.
\gloss{Compression d'image} : méthode permettant de réduire la place mémoire nécessaire au stockage sur le disque dur d'une image.
\gloss{Ecriture binaire} : écriture de valeurs numériques à l'aide uniquement de 0 et de 1.
\gloss{Flou} : dégradation d'une image qui rend les contours des objets peu net, et donc difficile à localiser précisément.
\gloss{Fondu} : interpolation linéaire entre deux images.
\gloss{Image couleur} : ensemble de trois images en niveaux de gris, qui peut être affiché à l'écran en couleur.
\gloss{Image numérique} : tableau de valeurs que l'on peut afficher à l'écran en assignant un niveaux de gris à chaque valeur.
\gloss{Inverse} : opération ramenant une image dans son état d'origine.
\gloss{JPEG-2000} : méthode récente de compression d'images qui utilise une transformation en ondelettes.
\gloss{Luminance} : moyenne des différents canaux d'une image, qui indique la puissance lumineuse du pixel.
\gloss{Matrice} : tableau de valeurs, représenté sous la forme \((a_{i,j})_{i,j}\).
\gloss{Médiane} : valeur centrale lorsque l'on classe par ordre croissant un ensemble de valeurs.
\gloss{Moyenne} : la moyenne d'un ensemble de valeurs est leur somme divisée par leur nombre.
\gloss{Niveaux de gris} : nuances de gris utilisées pour afficher à l'écran une image numérique.
\gloss{Nombres entiers} : nombres 0, 1, 2, 3, 4 ...
\gloss{Octet} : ensemble de huit bits consécutifs.
\gloss{Ondelettes} : transformation de l'image qui est utilisée par la méthode JPEG-2000 de compression d'images.
\gloss{Ordre croissant} : classement d'un ensemble de valeurs de la plus petite à la plus grande.
\gloss{Pixel} : une case dans un tableau de valeurs correspondant à une image numérique.
\gloss{Quantification} : procédé consistant à réduire l'ensemble des valeurs possibles d'une image numérique.
\gloss{Racine carrée} : la racine carrée \(b\) d'une valeur positive \(a\) est la valeur positive \(b\) vérifiant \(a=b \times b\). On la note \(\sqrt{a}\).
\gloss{Résolution} : taille d'une image (nombre de pixels).
\gloss{Sous-exposée} : photographie d'une scène trop sombre pour laquelle l'objectif photographique n'est pas resté assez longtemps ouvert.
\gloss{Synthèse additive} : règle permettant de construire une couleur quelconque à partir des trois couleurs rouge, vert et bleu. C'est la règle qui régit le mélange des couleurs de faisceaux lumineux utilisés pour l'éclairage d'un mur blanc.
\gloss{Synthèse soustractive} : règle permettant de construire une couleur quelconque à partir des trois couleurs cyan, magenta et jaune. C'est la règle qui régit le mélange des couleurs en peinture.
\end{rs}

 

